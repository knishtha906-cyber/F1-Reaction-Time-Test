<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>F1 Reaction Test</title>
    <style>
        *{
            margin:0;
            padding:0;
            box-sizing: border-box;
        }
        body{
            font-family: Arial, sans-serif;
            text-align: center;
            background: #1a1a1a;
            color: white;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #app{
            max-width: 1200px;
            width: 100%
        }

        h1{
            font-size: 2rem;
            margin-bottom: 10px;
        }

        p{
            font-size: 1rem;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        #lights{
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px auto;
            flex-wrap: nowrap;
            padding: 10px; 
        }

        .column{
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: black;
            padding: 10px;
            border-radius: 12px;
            flex-shrink: 0;
        }

        .light{
            width: 60px;
            height: 50px;
            border-radius: 50%;
            background: #222;
        }

        .light.on{
            background: red;
            box-shadow: 0 0 15px red;
        }

        .light.green{
            background: limegreen;
            box-shadow: 0 0 15px limegreen;
        }

        button{
            padding: 15px 40px;
            font-size: 1.1rem;
            margin: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #e10600;
            color: white;
            font-weight: bold;
            transition: background 0.3s;
        }

        button:hover{
            background: #ff0800;
        }

        button:disabled{
            background:#555;
            cursor: not-allowed;
        }
        
        button:active{
            transform: scale(0.95);
        }

        #result{
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            margin: 20px;
            min-height: 40px;
            font-weight: bold;
        }

        /*Mobile specific*/
        @media(max-width: 600px){
            body{
                padding; 10px;
            }

            #lights{
                gap: 8px;
            }

            .column{
                gap: 6px;
                padding: 6px;
            }

            .light{
                width: 35px;
                height: 30px;
            }
        }

        /*Tablet specific*/
        @media(min-width: 601px) and (max-width: 1024px){
            .light{
                width: 50px;
                height: 42px;
            }
        }

        /*Prevent text selection on mobile*/
        *{
            -webkit-touch-callout: none;
            -webkit-user-selection: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;

        }

    </style>
</head>
<body>
    <h1>F1 Reaction Test</h1>
    <p>Click Start, wait for all lights to turn green, then click ANYWHERE when they go green!</p>

    <div id="lights">
        <div class="column">
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
        </div>

        <div class="column">
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
        </div>

        <div class="column">
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
        </div>

        <div class="column">
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
        </div>

        <div class="column">
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
            <div class="light"></div>
        </div>
    </div>

        <button id="startBtn">Start</button>
        <div id="result"></div>
    
<script>
const columns = document.querySelectorAll('.column');
const startBtn = document.getElementById('startBtn');
const result = document.getElementById('result');

let startTime = null;
let canReact = false;
let raceRunning = false;
let greenLightTimeout = null; // â† YOU WERE MISSING THIS!

function resetLights() {
    document.querySelectorAll('.light').forEach(light => {
        light.classList.remove('on');
        light.classList.remove('green');
    });
}

function turnOnColumn(colIndex) {
    const lights = columns[colIndex].querySelectorAll('.light');
    lights[2].classList.add('on');
    lights[3].classList.add('on');
}

function showGreenLights() {
    // Don't show green lights if race was already stopped (false start)
    if (!raceRunning) return;
    
    canReact = true;
    startTime = performance.now();
    
    columns.forEach(column => {
        const lights = column.querySelectorAll('.light');
        // Turn OFF the bottom 2 red lights
        lights[2].classList.remove('on');
        lights[3].classList.remove('on');
        // Turn ON the top 2 green lights
        lights[0].classList.add('green');
        lights[1].classList.add('green');
    });
}

function startRace() {
    if (raceRunning) return;

    raceRunning = true;
    canReact = false;
    startBtn.disabled = true;

    resetLights();
    result.textContent = 'Get ready...';

    let currentColumn = 0;

    // Light up columns one by one
    const interval = setInterval(() => {
        if (currentColumn < columns.length) {
            turnOnColumn(currentColumn);
            currentColumn++;
        } else {
            clearInterval(interval);

            // Random delay before lights go green (1-3 seconds)
            const randomDelay = Math.random() * 2000 + 1000;
            greenLightTimeout = setTimeout(() => { 
                if (raceRunning){
                    showGreenLights();
                result.textContent = 'GO!';
                } 
            }, randomDelay);
        }
    }, 700);
}

// Start button only starts the race
startBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    startRace();
});

// Document click handles reactions
document.addEventListener('click', (e) => {
    if (e.target === startBtn) return;
    if (!raceRunning) return;

    if (!canReact) {
        // FALSE START - Cancel the green lights timeout
        clearTimeout(greenLightTimeout);
        raceRunning = false;
        canReact = false;
        result.textContent = 'FALSE START ðŸš«';
        resetLights();
        
        setTimeout(() => {
            result.textContent = '';
            startBtn.disabled = false;
        }, 2000);
        return;
    }

    // Valid reaction
    const reactionTime = performance.now() - startTime;
    result.textContent = `Reaction time: ${reactionTime.toFixed(0)} ms`;
    raceRunning = false;
    canReact = false;

    setTimeout(() => {
        resetLights();
        result.textContent = '';
        startBtn.disabled = false;
    }, 3000);
});
</script>
</body>
</html>